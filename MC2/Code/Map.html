<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <title>Basic geo (svg)</title>
</head>

<style>
    #content .map path {
        fill: #ddd;
        stroke: #aaa;
    }
    
    #content .map circle:hover{
        fill: black;
    }

</style>

<body>
    <div id="content">
        <svg width="400px" height="400px">
            <g class="map"></g>
        </svg>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>


    <script>
        d3.json('StHimark.geojson', geojson => {

            let width = 400,
                height = 400;
            let projection = d3.geoEquirectangular().scale(1).translate([0, 0]);

            let geoGenerator = d3.geoPath()
                .projection(projection);

            //Scaling and translating.
            var b = geoGenerator.bounds(geojson),
                s = .95 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height),
                t = [(width - s * (b[1][0] + b[0][0])) / 2, (height - s * (b[1][1] + b[0][1])) / 2];

            projection.scale(s).translate(t);

            function update(geojson) {
                var u = d3.select('#content g.map')
                    .selectAll('path')
                    .data(geojson.features);

                u.enter()
                    .append('path')
                    .attr('d', geoGenerator);
                
                var aa = [0.162679, -119.784825];
                u.enter().data(aa)
                        .append('circle')
                        .attr("cx", function(d) {
                            return projection([aa[1],aa[0]])[0];
                        })
                        .attr("cy", function(d) {
                            return projection([aa[1],aa[0]])[1];
                        })
                        .attr("r", "8px")
                        .attr("fill", "yellow")
                        .attr('id', "Hospital");
                var StaticLocations
                //console.log(projection(aa));
                d3.csv("../data/StaticSensorLocations.csv", function(data) {
                    StaticLocations = data;
                    //console.log(data);
                        u.enter().data(data)
                        .append('circle')
                        .attr("cx", function(d) {
                            return projection([d.Long,d.Lat])[0];
                        })
                        .attr("cy", function(d) {
                            return projection([d.Long,d.Lat])[1];
                        })
                        .attr("r", "8px")
                        .attr("fill", "red")
                        .attr('id',function(d) {
                            return d.Sensor;
                        });
                    console.log("finished");
                });



            }

            update(geojson);
        });

    </script>
</body>
